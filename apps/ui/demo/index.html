<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>xiaoy · SharedWorker Demo</title>
    <style>
      body { font: 14px/1.4 -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Helvetica, Arial, PingFang SC, Noto Sans SC, sans-serif; margin: 20px; }
      .row { margin: 8px 0; }
      input[type="text"]{ width: 380px; padding: 6px; }
      button { padding: 6px 10px; margin-right: 6px; }
      pre { background: #f6f8fa; padding: 12px; border-radius: 6px; overflow: auto; }
      .grid { display: grid; grid-template-columns: 200px 1fr; gap: 12px; align-items: start; }
      .badge { display: inline-block; padding: 2px 6px; border-radius: 4px; background: #eef; margin-left: 6px; }
    </style>
  </head>
  <body>
    <h1>SharedWorker Demo</h1>
    <div class="row">
      WS URL：<input id="wsUrl" type="text" placeholder="ws://localhost:8080/ws" />
      JWT：<input id="wsToken" type="text" placeholder="paste JWT or ?token=..." />
      <button id="btnConnect">连接</button>
      <button id="btnHealth">健康</button>
      <button id="btnSlow">慢消费者 +1</button>
      <span class="badge">FPS: <span id="fps">0</span></span>
      <span class="badge">Connections: <span id="conn">0</span></span>
      <span class="badge">Ports: <span id="ports">0</span></span>
    </div>
    <div class="row">
      订阅：<input id="subTopic" type="text" placeholder="xy.md.tick.demo" />
      <button id="btnSub">订阅</button>
      <button id="btnUnsub">退订</button>
      <button id="btnReconnect">断开并重连</button>
    </div>
    <div class="row">
      广播：<input id="broadcastText" type="text" placeholder="hello from this tab" />
      <button id="btnBroadcast">广播到所有标签</button>
    </div>
    <div class="grid">
      <div>心跳</div>
      <pre id="hb"></pre>
      <div>健康报告</div>
      <pre id="health"></pre>
      <div>消息</div>
      <pre id="out"></pre>
    </div>
    <script type="module" src="./main.mjs"></script>
    <script type="module">
      import { attachMetricsOverlay } from '../src/overlay/metrics-overlay.mjs'
      attachMetricsOverlay({})
    </script>
  </body>
  </html>
