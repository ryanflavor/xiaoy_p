<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dashboard · MinimalPanel（E2E 测试页）</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; margin:0; background:#f6f8fa; }
    #app { height: 100vh; }
    .toolbar { position: fixed; right: 12px; top: 12px; z-index: 10; display:flex; gap:8px }
    .toolbar button { padding:6px 10px; border:1px solid #d1d5da; border-radius:6px; background:#fff; cursor:pointer }
  </style>
</head>
<body>
  <div class="toolbar">
    <button id="btnDegrade">Degrade (fps=15)</button>
    <button id="btnRecover">Recover (fps=65)</button>
  </div>
  <div id="app"></div>

  <script type="module">
    import { MinimalPanel as PanelFactory } from '/src/pages/dashboard/MinimalPanel.mjs'
    import minimalPanelStore from '/src/stores/minimalPanelStore.mjs'

    const root = document.getElementById('app')
    PanelFactory(root)

    // Expose for E2E
    window.minimalPanelStore = minimalPanelStore

    // Manual controls
    document.getElementById('btnDegrade').onclick = () => minimalPanelStore.handleMetricsUpdate({ fps: 15 })
    document.getElementById('btnRecover').onclick = () => minimalPanelStore.handleMetricsUpdate({ fps: 65 })

    // Visual hint: show current FPS / level in title so buttons有反馈
    minimalPanelStore.subscribe((s) => {
      document.title = `FPS ${Math.round(s.metrics.fps)} · L${s.degradation.level}`
    })
  </script>
</body>
</html>
