# dev-story · 执行检查点（Step 1–4）

执行时间 (UTC)：$(date -u +%Y-%m-%dT%H:%M:%SZ)
执行模式：normal（仅 apps/ui 测试范围）

## Step 1 · 选择故事与定位任务

- status_exists: true
- in_progress_story: 1.3
- story_path: docs/stories/story-1.3.md
- first_incomplete_task: SharedWorker 单连接骨架（AC1）

## Step 2 · 计划与实现

- 实施内容：
  - `WSManager` 单例（apps/ui/src/lib/ws/manager.mjs）
  - SharedWorker 脚本与心跳（apps/ui/src/worker/shared/shared-worker.ts）
  - 跨标签 Bus（apps/ui/src/lib/bus/channel.ts）
- 约束：暂不引入额外依赖；保持可在 Node 环境下测试。

## Step 3 · 测试编写

- 新增：apps/ui/test/ws-manager.test.mjs（2 个断言，用例见文件）

## Step 4 · 运行测试与验证

- 运行命令：`cd apps/ui && npm test`
- 结果：通过 2/2；无回归（限定在 apps/ui 范围）
- 说明：仓库根目录 `node --test` 会执行 services/ws-gateway 的 Vitest 栈并失败（需按包内脚本运行 `pnpm -w --filter @xiaoy/ws-gateway test` 且先构建）。本故事聚焦 UI（AC1），因此按包级粒度执行。

