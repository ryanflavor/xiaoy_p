# dev-story · 执行检查点（AC3）

执行时间 (UTC)：$(date -u +%Y-%m-%dT%H:%M:%SZ)

## 变更摘要
- 扩展 `WSManager`（apps/ui/src/lib/ws/manager.mjs）：
  - 指数回退（初始100ms、factor=2、cap=3s、抖动）+ 并发上限（1）。
  - 订阅恢复：断线后 `open` 时重发订阅；提供 `addSubscription/removeSubscription`。
  - 健康报告：`health()` 返回连接状态、重连次数、下一次退避、订阅数等；`recordSlowConsumer()` 计数。
- SharedWorker 支持健康查询与慢消费者记录：apps/ui/src/worker/shared/shared-worker.ts。
- 新增测试 apps/ui/test/reconnect.test.mjs：
  1) 指数回退上限；
  2) 并发重连上限；
  3) 订阅恢复与 ≤3s 约束（时间源可注入）。
- 运行 `cd apps/ui && npm test`：8/8 通过。

## 注意
- 根目录 `npm test` 会触发 services/ws-gateway 的 Vitest（当前未构建且存在占位测试），不在本故事验证范围；按包级执行 UI 测试即可满足 AC。

